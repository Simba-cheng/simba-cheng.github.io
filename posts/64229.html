<!DOCTYPE html><html lang="zh-CN" color-mode="light"><head><link href="https://fastly.jsdelivr.net/npm/hexo-tag-common@0.2.0/css/index.css" rel="stylesheet"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script defer src="/_vercel/insights/script.js"></script><script defer src="/_vercel/speed-insights/script.js"></script><meta name="author" content="yxcheng"><title>ElasticSearch-基础-02-基本概念 | 躺着好舒服</title><link rel="apple-touch-icon" href="/images/favicon.png"><link rel="icon" href="/images/favicon.png"><link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css"><link rel="stylesheet" href="/css/figcaption/mac-block.css"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3163875893588085" crossorigin="anonymous"></script><script defer type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><link href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" rel="stylesheet"><script defer type="text/javascript" src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="/js/fancybox.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-WB9L6JQGS1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WB9L6JQGS1")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>var html=document.documentElement;const colorMode=localStorage.getItem("color-mode");colorMode&&document.documentElement.setAttribute("color-mode",colorMode)</script><link rel="stylesheet" href="/css/collapse-code.css"><script src="/js/collapse-code.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="躺着好舒服" type="application/atom+xml"></head><body><div id="app"><div class="header"><div class="avatar"><a href="/"><img no-lazy src="/images/avatar.png" alt=""></a><div class="nickname"><a href="/">躺着好舒服</a></div></div><div class="navbar"><ul><li class="nav-item" data-path="/"><a href="/">首页</a></li><li class="nav-item" data-path="/tags/"><a href="/tags/">标签</a></li><li class="nav-item" data-path="/categories/"><a href="/categories/">分类</a></li><li class="nav-item" data-path="/archives/"><a href="/archives/">归档</a></li><li class="nav-item" data-path="/notes/"><a href="/notes/">Notes</a></li><li class="nav-item" data-path="/adventure/"><a href="/adventure/">冒险乐园</a></li></ul></div></div><script src="/js/activeNav.js"></script><div class="flex-container"><script async type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script><script src="/js/codeCopy.js"></script><div class="container post-details" id="post-details"><div class="post-content"><div class="post-title">ElasticSearch-基础-02-基本概念</div><div class="post-attach"><span class="post-pubtime"><i class="iconfont icon-updatetime mr-10" title="更新时间"></i> 创建时间:2019-09-22 19:49:02&nbsp; 更新时间:2025-04-21 09:14:58 &nbsp;&nbsp; </span><span><span><i class="iconfont icon-edit"></i> 3k 字 </span>&nbsp;&nbsp; </span><span class="post-tags"><i class="iconfont icon-tags mr-10" title="标签"></i> <span class="span--tag mr-8"><a href="/tags/elasticSearch/" title="elasticSearch">#elasticSearch&nbsp;</a></span></span></div><div class="markdown-body"><center><a style="font-style:italic" href="javascript:window.location='https://simba--cheng-cn.translate.goog/' + window.location.pathname + '?_x_tr_sl=zh-CN&amp;_x_tr_tl=en&amp;_x_tr_hl=zh-CN&amp;_x_tr_pto=wapp';">This post is also available in English and alternative languages.</a></center><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><br><blockquote style="border-left:4px solid #6495ed;background-color:#f5f5f5;padding:10px 20px"><p>ElasticSearch版本：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/index.html" target="_blank">6.5.0(点击跳转官方文档)</a></p></blockquote><p>Elasticsearch 是一个近实时分布式全文搜索引擎，它基于 Apache Lucene。</p><br><h1 id="近实时">1. 近实时</h1><p>实时的应用程序在严格的时间限制下运行。</p><p>也就是说，它们可以在固定的时间内执行操作，时间的限制通常以微秒、毫秒为单位。</p><p>elasticsearch提供 接近实时的搜索，新增到 elasticsearch 中的文档在’定期时间’后就可以被检索到。</p><p>这个’定期时间’默认是每秒一个状态，但这并不意味着可以保证新文档在一秒就到达索引。</p><p>这种 新增数据对搜索的可见行称为”准实时搜索”</p><br><h1 id="分布式">2. 分布式</h1><p>分布式意味着可以动态调整集群规模，弹性扩容，而且操作起来非常简便。</p><br><h1 id="全文">3. 全文</h1><p>对全部的文本内容进行分析，建立索引，使之可以被搜索，因此称为全文。</p><br><h1 id="集群">4. 集群</h1><p>一个集群（cluster）由一个或多个拥有<font color="#FF4500">相同cluster.name配置</font>的节点组成。</p><p>它们共同承担数据和负载的压力；</p><p>当有节点加入集群或从集群中移除节点时，集群将会重新平均分布所有的数据。</p><p>当新加入节点或删除节点，<font color="#FF4500">集群会感知并平衡数据</font>。</p><p><font color="#FF4500">集群中的任何节点 通过选举 都有可能成为主节点&#x2F;Master，当然需要通过配置来获得资格</font></p><br><h1 id="节点">5. 节点</h1><p>节点是一个服务器，它是集群的一部分，存储数据，并参与集群的索引和搜索功能</p><p>节点有一个名称标识，该名称在缺省情况下是在启动时分配给节点的随机全局惟一标识符（UUID）</p><br><h1 id="节点角色">6. 节点角色</h1><p>集群节点角色有：</p><p><strong>主节点(master node)<strong>，</strong>数据节点(data node)<strong>，</strong>预处理节点(ingest node)<strong>，</strong>协调节点(coordinating node)<strong>，</strong>部落节点(tribe node)</strong></p><br><h2 id="主节点-master-node">6.1. 主节点 master node</h2><p>当一个节点被选举成<strong>主节点</strong>时，它将<strong>负责管理集群范围内节点&#x2F;索引层面的所有变更</strong>。</p><p>在 elasticsearch.yml 配置文件中，通过配置 node.master: true 使节点具有被选举为master的资格。</p><p>主节点是全局唯一的，从有资格成为master的节点中进行选举。</p><blockquote><p>注意：主节点也可以作为数据节点，但应该尽可能减少其工作；生产环境尽量分离 主节点 和 数据节点</p></blockquote><p>主节点不需要涉及文档级别的变更和搜索等操作；所以当集群只拥有一个主节点的情况下，即使流量的增加它也不会成为瓶颈；</p><p>创建独立主节点配置：</p><figure class="highlight yaml"><figcaption><span>elasticsearch.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><br><h2 id="数据节点-data-node">6.2. 数据节点 data node</h2><p>数据节点 负责保存数据，执行数据的相关操作，例如：CRUD&#x2F;搜索&#x2F;聚合等。</p><p>数据节点对 CPU 和 IO要求较高</p><p>一般情况下，数据的读写流程只和数据节点打交道，除非是异常情况，才会和主节点交互。</p><p>创建独立数据节点配置：</p><figure class="highlight yaml"><figcaption><span>elasticsearch.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node.master:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.ingest:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><br><h2 id="预处理节点-ingest-node">6.3. 预处理节点 ingest node</h2><p><strong>预处理节点是 5.0版本开始引入的</strong></p><p>它允许在写入数据之前，通过事先定义好的processes(处理器)或pipeline(管道)，对数据进行某种转换&#x2F;富化</p><p>processes 和 pipeline 会拦截 bulk 和 index请求，在处理后，将文档回传给 index 或 bulk api。</p><p>默认情况下，是启用ingest的，</p><p>创建一个仅用于预处理的节点：</p><figure class="highlight yaml"><figcaption><span>elasticsearch.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node.master:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">node.ingest:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><br><h2 id="协调节点-coordinating-node">6.4. 协调节点 coordinating node</h2><p>协调节点负责查询时的数据收集、合并以及聚合等操作。</p><p>默认的，ElasticSearch集群中所有的节点都是协调节点。</p><p>创建一个仅用于协调的节点：</p><figure class="highlight yaml"><figcaption><span>elasticsearch.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node.master:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">node.ingest:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><br><h2 id="部落节点-tribe-node">6.5. 部落节点 tribe node</h2><p><del>暂不关注</del></p><br><h1 id="集群健康">7. 集群健康</h1><p>集群健康有三种状态：green、yellow、red。</p><ul><li>green 所有主要分片和复制分片都可用</li><li>yellow 所有主要分片可用，但不是所有复制分片都可用</li><li>red	有主要分片不可用</li></ul><p>查看集群健康 curl命令：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET &#x27;localhost:9200/<span class="built_in">_</span>cat/health?v<span class="built_in">&amp;</span>pretty&#x27;</span><br></pre></td></tr></table></figure><p>获取集群机器列表 curl命令：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET &#x27;localhost:9200/<span class="built_in">_</span>cat/nodes?v<span class="built_in">&amp;</span>pretty&#x27;</span><br></pre></td></tr></table></figure><br><h1 id="分片-主分片、副本分片">8. 分片(主分片、副本分片)</h1><h2 id="分片">8.1. 分片</h2><p>索引可能存储大量数据，这些数据可能超过单个节点的硬件限制。</p><p>为了解决这个问题，Elasticsearch提供了将索引细分为多个碎片(分片)的功能，每个碎片(分片)称之为shard；</p><ol><li><p>索引数据被分配到各个分片上（相当于一桶水用了N个杯子装）。</p></li><li><p>分片有助于横向扩展</p></li></ol><p>分片：是底层的基础读写&#x2F;工作单元，<strong>它仅保存全部数据中的一部分</strong></p><p>分片的目的是<strong>分割索引，让读写可以并行操作，由多台机器共同完成。</strong></p><p>一个分片就是一个Lucene实例，它本身就是一个完整的搜索引擎。</p><p>我们的文档被存储到分片内，应用程序直接与索引交互而不是分片。</p><p>分片是数据的容器，文档保存在分片内，分片又被分配到集群中的各个节点中。</p><p>elasticsearch 将分片区分成两部分，即 <strong>主分片</strong> 和 <strong>副本分片</strong>。</p><p><b><font color="#FF4500">索引内任意一个文档都归属于一个主分片，所以 主分片的数量决定了索引能够保存的最大数据量。</font></b></p><p><b><font color="#FF4500">一个副本分片只是一个主分片的拷贝。副本分片作为故障时保护数据不丢失的冗余备份</font></b>，并且为搜索&#x2F;读操作提供服务。</p><p>注意：索引建立的时候就已经确定主分片数量，索引建立后不可更改，但副本分片数量可以随时更改。</p><br><h2 id="主分片">8.2. 主分片</h2><p>主分片：作为权威数据，写过程中 先写主分片，成功后再写副本分片；恢复阶段以主分片为准。</p><br><h2 id="副本分片">8.3. 副本分片</h2><p>副本分片指的是主分片的副本，是shard的复制（分片的冗余备份，防止某个分片挂了，数据丢失）</p><p>副本之所以重要，主要有两个原因：</p><ol><li><p>在shard&#x2F;node失败的时候，它提供高可用性。正因为如此，复制的shard（简称shard的副本）绝不会跟原始shard在同一个节点上</p></li><li><p>它允许扩展搜索量&#x2F;吞吐量，因为搜索可以并行地在所有副本上执行</p></li></ol><p>在不同场景下，副本分片有不同的作用</p><p><strong>故障</strong></p><p>如果集群中，持有主分片的节点故障了，一个副本分片就会晋升为主分片。</p><p><strong>写数据</strong></p><p>新文档首先被索引(存储)到主分片中，然后再同步到其他所有的副本分片中。</p><p>增加副本分片数量，并不会增加索引容量。</p><p><strong>读数据</strong></p><p>副本分片不论何时，都可以提供 读&#x2F;搜索 功能。</p><p>如果索引偏向查询使用，可以通过增加副本分片数量，提高查询性能；(硬件资源也要增加)</p><p>图例：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/posts/64229/ElasticsearchCluster.jpg" alt="从应用程序和管理员的角度看Elasticsearch集群" title="从应用程序和管理员的角度看Elasticsearch集群"></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/posts/64229/elasticsearch%E8%8A%82%E7%82%B9_%E7%B4%A2%E5%BC%95_%E5%88%86%E7%89%87%E7%BB%93%E6%9E%84.png" alt="elasticsearch节点_索引_分片" title="elasticsearch节点_索引_分片"></p><br><h2 id="注意">8.4. 注意</h2><p>主分片数量是在创建索引时就确定的，索引创建完成后不可更改，主分片数量决定了这个索引能 存储&#x2F;写入 多少数据量。</p><p>但是，搜索&#x2F;读取 操作，可以同时被 主分片和副本分片处理，所以，<font color="#FF4500"><strong>拥有越多的副本分片，也将拥有越高的数据吞吐量</strong></font>。</p><br><h1 id="索引">9. 索引</h1><p>索引（index）这个词在elasticsearch中有不同的含义，有必要区分一下：</p><ul><li><p>索引（名词）：这个索引，就像是传统关系型数据库中的数据库，在Elasticsearch中它是相关文档存储的地方，索引实际上是指向一个或多个物理分片的逻辑命名空间。</p></li><li><p>索引（动词）：”索引一份文档”，表示把一个文档存储到索引(名词)里，以便它可以被检索或查询。这很像SQL中的insert关键字，差别是，如果文档已经存在，新的文档回覆盖旧的文档。</p></li><li><p>反向索引（或传统数据库其他类型的索引）：数据结构；传统数据库为特定列增加一个索引，例如B-Tree索引来加速检索。elasticsearch、Lucene使用一种叫做倒排索引的数据结构来达到相同的目的。</p></li></ul><br><h1 id="映射类型">10. 映射类型</h1><p>在elasticsearch 6.0.0 版本之前，一个索引可以包含多个映射类型</p><blockquote><p>Indices created in Elasticsearch 6.0.0 or later may only contain a single mapping type.<br>Indices created in 5.x with multiple mapping types will continue to function as before in Elasticsearch 6.x.<br>Types will be deprecated in APIs in Elasticsearch 7.0.0, and completely removed in 8.0.0.<br>– <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/removal-of-types.html">Removal of mapping types</a></p></blockquote><p>在elasticsearch 6.0.0 版本之后，索引只能包含一个映射类型。</p><p>映射类型是索引中逻辑的种类&#x2F;分区，它的语义完全取决于自己。</p><p>一般情况下，一个映射类型被定义成一组常见字段的文档。</p><blockquote><p>如果把索引看做数据库、类型看做表、映射就是表结构。请注意，仅为了加速理解。这种对比并不好，数据库表可以创建多个，但Elasticsearch6.x版本后，一个index只支持一个type</p></blockquote><p>elasticsearch对于映射类型处理有两种方式：动态映射、静态映射</p><p>详细见：<a href="/posts/55247.html" title="ElasticSearch-基础-05-Mapping_数据类型">ElasticSearch-基础-05-Mapping_数据类型</a></p><br><h1 id="文档">11. 文档</h1><p>document（文档）是索引信息的基本单位。</p><p>例如，您有一存储 customer（客户）数据的文档，另一个是存储 product（产品）数据的文档，还有一个是存储 order（订单）数据的文档。</p><p>该文档可以使用 JSON 来表示，它是一种无处不在的互联网数据交换格式。</p><p>在索引&#x2F;类型中，您可以存储许多文档。注意，尽管一个文档物理的存在于索引中，实际上一个文档必须被 索引&#x2F;分配 给索引内的类型。</p><br><h1 id="路由">12. 路由</h1><p>当索引(动词&#x2F;存储)一个文档时，它被存储在某个主分片中。</p><p>Elasticsearch 是如何划分的？怎么决定A文档写到shard-A分片中，而不是shard-B分片中去呢？</p><p>Elasticsearch中有一个算法：将数据均匀的分配到各个分片的算法。</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shard = hash(routing) <span class="comment">% number_of_primary_shard</span></span><br></pre></td></tr></table></figure><p>上面表达式中的routing是一个变量，如果不设置，默认是文档id，也可以是自定义的值。</p><p>routing值hash后，除以主分片数量，得到一个余数(这个余数值范围永远是 0 ～ number_of_primary_shard-1)。</p><p>最后得到的值，即是 文档所在的分片。</p><p>这里也解释了 为什么主分片数量在创建索引后就不允许修改了。</p><p>如果主分片数量修改了，那之前的路由值也就失效了，文档再也检索不到了。</p><p>所有文档API(get、index、delete、bulk、mget)都接收一个routing参数，它用来自定义文档到分片的映射。</p><p>自定义路由值可以确保所有相关文档，例如属于同一人的文档，都保存在同一分片上。</p><br><h1 id="加深理解">13. 加深理解</h1><p>将elasticsearch和传统数据库进行比较，以此来理解elasticSearch中的概念：</p><table><thead><tr><th>DB</th><th>ElasticSearch</th></tr></thead><tbody><tr><td>DataBases（数据库）</td><td>Index&#x2F;Indices（索引）</td></tr><tr><td>Tables(表)</td><td>Types（映射类型）</td></tr><tr><td>Rows（行）</td><td>Documents（文档）</td></tr><tr><td>Columns（列）</td><td>Fields（字段）</td></tr></tbody></table><p>（仅是为了加速理解，不能真的以此进行横向比较，在Elasticsearch6.0.0或更高版本中创建的索引可能只包含单个映射类型）</p><br><h1 id="Reference">14. Reference</h1><ul><li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/laoyang360/article/details/78396928">干货 | Elasticsearch5.X Mapping万能模板</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cjsblog/p/10125342.html">Elasticsearch Document</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/26446020">在ElasticSearch中，集群(Cluster),节点(Node),分片(Shard),Indices(索引),replicas(备份)之间是什么关系？</a></p></li><li><p><a href=".">Basic Concepts（基础概念）</a></p></li><li><p><a target="_blank" rel="noopener" href="https://doc.yonyoucloud.com/doc/mastering-elasticsearch/chapter-4/42_README.html">路由功能浅谈</a></p></li><li><p>《Elasticsearch in Action》</p></li><li><p>《Elasticsearch源码解析与优化实战》</p></li><li><p>《Elasticsearch 权威指南》</p></li></ul><link rel="stylesheet" href="/css/folder.css" type="text/css"><script src="/js/folder.js" type="text/javascript" async></script><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div></div><div id="btn-catalog" class="btn-catalog"><i class="iconfont icon-catalog"></i></div><div class="post-catalog hidden" id="catalog"><div class="title">目录</div><div class="catalog-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%91%E5%AE%9E%E6%97%B6"><span class="toc-text">1. 近实时</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F"><span class="toc-text">2. 分布式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E6%96%87"><span class="toc-text">3. 全文</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4"><span class="toc-text">4. 集群</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8A%82%E7%82%B9"><span class="toc-text">5. 节点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E8%A7%92%E8%89%B2"><span class="toc-text">6. 节点角色</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E8%8A%82%E7%82%B9-master-node"><span class="toc-text">6.1. 主节点 master node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9-data-node"><span class="toc-text">6.2. 数据节点 data node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E8%8A%82%E7%82%B9-ingest-node"><span class="toc-text">6.3. 预处理节点 ingest node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E8%B0%83%E8%8A%82%E7%82%B9-coordinating-node"><span class="toc-text">6.4. 协调节点 coordinating node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E8%90%BD%E8%8A%82%E7%82%B9-tribe-node"><span class="toc-text">6.5. 部落节点 tribe node</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%81%A5%E5%BA%B7"><span class="toc-text">7. 集群健康</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E7%89%87-%E4%B8%BB%E5%88%86%E7%89%87%E3%80%81%E5%89%AF%E6%9C%AC%E5%88%86%E7%89%87"><span class="toc-text">8. 分片(主分片、副本分片)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%89%87"><span class="toc-text">8.1. 分片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E5%88%86%E7%89%87"><span class="toc-text">8.2. 主分片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%AF%E6%9C%AC%E5%88%86%E7%89%87"><span class="toc-text">8.3. 副本分片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-text">8.4. 注意</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-text">9. 索引</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">10. 映射类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-text">11. 文档</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-text">12. 路由</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A0%E6%B7%B1%E7%90%86%E8%A7%A3"><span class="toc-text">13. 加深理解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-text">14. Reference</span></a></li></ol></div></div><script src="/js/catalog.js"></script><div class="comments-container"></div></div><div class="footer"><div class="social"><ul><li><a title="github" target="_blank" rel="noopener" href="https://github.com/Simba-cheng"><i class="iconfont icon-github"></i></a></li><li><a title="rss" href="/atom.xml"><i class="iconfont icon-rss"></i></a></li></ul></div><div class="footer-more"><a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2025 Oranges</a></div><div class="footer-more"><a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a></div><div class="footer-views">本站总访问量<span id="busuanzi_value_site_pv"></span>次 本文总阅读量<span id="busuanzi_value_page_pv"></span>次 本站访客数<span id="busuanzi_value_site_uv"></span>人</div></div></div><div class="tools-bar"><div class="back-to-top tools-bar-item hidden"><a href="javascript: void(0)"><i class="iconfont icon-chevronup"></i></a></div><script src="/js/backtotop.js"></script><div class="search-icon tools-bar-item" id="search-icon"><a href="javascript: void(0)"><i class="iconfont icon-search"></i></a></div><div class="search-overlay hidden"><div class="search-content" tabindex="0"><div class="search-title"><span class="search-icon-input"><a href="javascript: void(0)"><i class="iconfont icon-search"></i> </a></span><input type="text" class="search-input" id="search-input" placeholder="搜索..."> <span class="search-close-icon" id="search-close-icon"><a href="javascript: void(0)"><i class="iconfont icon-close"></i></a></span></div><div class="search-result" id="search-result"></div></div></div><script type="text/javascript">var inputArea=document.querySelector("#search-input"),searchOverlayArea=document.querySelector(".search-overlay");function openOrHideSearchContent(){searchOverlayArea.classList.contains("hidden")?(searchOverlayArea.classList.remove("hidden"),document.body.classList.add("hidden")):(searchOverlayArea.classList.add("hidden"),document.body.classList.remove("hidden"))}function blurSearchContent(e){e.target===searchOverlayArea&&openOrHideSearchContent()}inputArea.onclick=function(){getSearchFile(),this.onclick=null},inputArea.onkeydown=function(){if(13==event.keyCode)return!1},document.querySelector("#search-icon").addEventListener("click",openOrHideSearchContent,!1),document.querySelector("#search-close-icon").addEventListener("click",openOrHideSearchContent,!1),searchOverlayArea.addEventListener("click",blurSearchContent,!1);var searchFunc=function(e,t,n){"use strict";var r=document.getElementById(t),a=document.getElementById(n);a.innerHTML="<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>",$.ajax({url:e,dataType:"xml",success:function(e){var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get();a.innerHTML="",r.addEventListener("input",function(){var u='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);if(a.innerHTML="",!(this.value.trim().length<=0)){if(t.forEach(function(e){var n,r,a=!0,t=(e.title&&""!==e.title.trim()||(e.title="Untitled"),e.title.trim()),c=t.toLowerCase(),s=e.content.trim().replace(/<[^>]+>/g,""),i=s.toLowerCase(),e=e.url,l=-1,o=-1;""!==i?h.forEach(function(e,t){n=c.indexOf(e),l=i.indexOf(e),n<0&&l<0?a=!1:(l<0&&(l=0),0==t&&(o=l))}):a=!1,a&&(u+="<li><a href='"+e+"' class='search-result-title'>"+t+"</a>",0<=o&&(e=o+80,(e=0==(t=(t=o-20)<0?0:t)?100:e)>s.length&&(e=s.length),r=s.substr(t,e),h.forEach(function(e){var t=new RegExp(e,"gi");r=r.replace(t,'<span class="search-keyword">'+e+"</span>")}),u+='<p class="search-result-abstract">'+r+"...</p>"),u+="</li>")}),-1===(u+="</ul>").indexOf("<li>"))return a.innerHTML="<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";a.innerHTML=u}})},error:function(e,t,n){a.innerHTML="",404===e.status?a.innerHTML="<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>":a.innerHTML="<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>"}}),$(document).on("click","#search-close-icon",function(){$("#search-input").val(""),$("#search-result").html("")})},getSearchFile=function(){searchFunc("/search.xml","search-input","search-result")}</script><div class="tools-bar-item theme-icon" id="switch-color-scheme"><a href="javascript: void(0)"><i id="theme-icon" class="iconfont icon-moon"></i></a></div><script src="/js/colorscheme.js"></script><div class="share-icon tools-bar-item"><a href="javascript: void(0)" id="share-icon"><i class="iconfont iconshare"></i></a><div class="share-content hidden"><a class="share-item" href="https://twitter.com/intent/tweet?text=' + ElasticSearch-%E5%9F%BA%E7%A1%80-02-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5 + '&url=' + https%3A%2F%2Fsimba-cheng.github.io%2Fposts%2F64229.html + '" target="_blank" title="Twitter"><i class="iconfont icon-twitter"></i> </a><a class="share-item" href="https://www.facebook.com/sharer.php?u=https://simba-cheng.github.io/posts/64229.html" target="_blank" title="Facebook"><i class="iconfont icon-facebooksquare"></i></a></div></div><script src="/js/shares.js"></script></div></div><script src="https://fastly.jsdelivr.net/npm/hexo-tag-common@0.2.0/js/index.js"></script><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:3,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a=c[o],i=function(){c=c.filter(function(t){return a!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(a)};(t=a).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),i()):(e=new Image,n=t.getAttribute("data-original"),e.onload=function(){t.src=n,t.removeAttribute("data-original"),i()},t.src!==n&&(e.src=n))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this)</script><script src="/js/markmap.js"></script></body></html>